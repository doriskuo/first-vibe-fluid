---
description: AI encountering errors during development
---

# AI 錯誤處理流程

> **執行時機**：當開發過程中遇到錯誤且重試失敗時

---

## 錯誤分級

### Level 1: 輕微錯誤
- 語法提示、格式問題、Linter 警告
- **處理**：直接修正，不記錄

### Level 2: 中度錯誤
- 編譯錯誤、測試失敗、依賴問題
- **處理**：最多重試 3 次，記錄到 `開發紀錄_dev_log.md`

### Level 3: 重大錯誤
- 架構問題、邏輯衝突、設計缺陷
- **處理**：立即停止，記錄到 `經驗教訓_lessons.md`，通知用戶協作討論

---

## AI 處理步驟

### Step 1: 識別錯誤級別
判斷當前錯誤屬於 Level 1/2/3

### Step 2: Level 1 處理
// turbo
直接修正，繼續開發

### Step 3: Level 2 處理 (中度錯誤)

**重試規則**：
1. 第 1 次重試：嘗試替代方案 A
2. 第 2 次重試：嘗試替代方案 B（必須與方案 A 不同）
3. 第 3 次重試：嘗試方案 C（從不同角度思考）
4. 重試 3 次後仍失敗 → 升級為 Level 3

**禁止**：重複執行相同的命令期待不同結果

### Step 4: 記錄嘗試過程
// turbo
echo "## $(date +%Y-%m-%d\ %H:%M) - [錯誤]" >> docs/projects/*/開發紀錄_dev_log.md
echo "### 錯誤描述" >> docs/projects/*/開發紀錄_dev_log.md
echo "### 嘗試方案" >> docs/projects/*/開發紀錄_dev_log.md
echo "1. 方案 A - [結果]" >> docs/projects/*/開發紀錄_dev_log.md
echo "2. 方案 B - [結果]" >> docs/projects/*/開發紀錄_dev_log.md

### Step 5: Level 3 處理 (重大錯誤)

⚠️ **立即執行**：

1. **停止開發**：不再嘗試自動修復
2. **記錄經驗教訓**：寫入 `經驗教訓_lessons.md`
3. **通知用戶**：使用 `notify_user` 工具

**通知格式**：
```
🚨 遇到重大錯誤，已嘗試 3 種方案仍未解決

**錯誤描述**：[簡短描述]

**已嘗試方案**：
1. 方案 A - 失敗原因：[...]
2. 方案 B - 失敗原因：[...]
3. 方案 C - 失敗原因：[...]

**可能原因分析**：
- 原因 1: [...]
- 原因 2: [...]

**建議討論方向**：
- 方向 1: [替代技術/架構]
- 方向 2: [不同的實現邏輯]
- 方向 3: [簡化需求或分階段實現]

📋 已記錄到 `經驗教訓_lessons.md`
```

### Step 6: Revert 決策

**建議 Revert 時機**：
- Level 2 錯誤重試 3 次失敗
- 修改導致更多新錯誤
- 不確定如何修復，且有穩定版本可回退

**執行前詢問**：
```
⚠️ 建議 revert 到上一個穩定版本 [commit hash]

是否執行？
- [ ] 是，revert 並重新規劃
- [ ] 否，我想嘗試其他方案
```

---

## 特殊規則

### 🚫 禁止行為
- 禁止重複相同命令超過 2 次
- 禁止在不理解錯誤原因時盲目修改
- 禁止跳過錯誤繼續開發（掩蓋問題）

### ✅ 最佳實踐
- 每次重試必須有不同的策略
- 思考錯誤的根本原因，不只是表面症狀
- 參考官方文檔、業界最佳實踐
- Level 3 錯誤必須與用戶協作討論

---

## AI 自我檢查清單

執行錯誤處理時，AI 應自問：

- [ ] 我理解錯誤的根本原因嗎？
- [ ] 我嘗試的方案是否真的不同？
- [ ] 我是否查閱了相關文檔？
- [ ] 這個錯誤是否應該記錄下來？
- [ ] 我是否應該停止並尋求用戶協助？
